#!/bin/bash
# Stop AeroSpace, SketchyBar, Borders, and SwipeAeroSpace

echo "ðŸ›‘ Stopping Makaron UI components..."
echo ""

# Disable AeroSpace (doesn't quit, just disables window management)
if command -v aerospace &> /dev/null; then
    if pgrep -f "AeroSpace" > /dev/null; then
        echo "  Disabling AeroSpace..."
        aerospace enable off
        echo "  âœ“ AeroSpace disabled"
    else
        echo "  âš ï¸  AeroSpace not running"
    fi
else
    echo "  âš ï¸  AeroSpace not installed"
fi

# Stop SketchyBar service
if command -v sketchybar &> /dev/null; then
    if brew services list | grep -q "sketchybar.*started"; then
        echo "  Stopping SketchyBar..."
        brew services stop sketchybar 2>/dev/null
        echo "  âœ“ SketchyBar stopped"
    else
        echo "  âš ï¸  SketchyBar not running"
    fi
else
    echo "  âš ï¸  SketchyBar not installed"
fi

# Stop Borders (process and service)
if command -v borders &> /dev/null; then
    if pgrep -f "borders" > /dev/null; then
        echo "  Stopping Borders..."
        killall borders 2>/dev/null
        brew services stop borders 2>/dev/null || true
        echo "  âœ“ Borders stopped"
    else
        echo "  âš ï¸  Borders not running"
    fi
else
    echo "  âš ï¸  Borders not installed"
fi

# Quit SwipeAeroSpace
if [ -d "/Applications/SwipeAeroSpace.app" ]; then
    if pgrep -f "SwipeAeroSpace" > /dev/null; then
        echo "  Quitting SwipeAeroSpace..."
        killall SwipeAeroSpace 2>/dev/null
        echo "  âœ“ SwipeAeroSpace quit"
    else
        echo "  âš ï¸  SwipeAeroSpace not running"
    fi
fi

# Show Dock (disable autohide)
echo "  Showing macOS Dock..."
defaults write com.apple.dock autohide -bool false
killall Dock
echo "  âœ“ Dock visible"

# Enable Three Finger Drag (disable Mission Control gesture)
echo "  Enabling Three Finger Drag..."
defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadThreeFingerDrag -bool true 2>/dev/null
defaults write com.apple.AppleMultitouchTrackpad TrackpadThreeFingerDrag -bool true 2>/dev/null
echo "  âœ“ Three Finger Drag enabled"

# Enable Transparency (disable Reduce Transparency)
echo "  Enabling macOS transparency..."
if defaults write com.apple.universalaccess reduceTransparency -bool false 2>/dev/null; then
    echo "  âœ“ Transparency enabled"
else
    echo "  â„¹ï¸  Transparency: Please disable manually in System Settings"
    echo "     System Settings â†’ Accessibility â†’ Display â†’ Reduce transparency (turn OFF)"
fi

# Menu bar setting - manual configuration needed in macOS Sequoia 15+
echo "  â„¹ï¸  Menu Bar: Please set manually in System Settings"
echo "     Opening System Settings > Desktop & Dock..."
echo "     Set 'Automatically hide and show the menu bar' to: Never"
open "x-apple.systempreferences:com.apple.preference.dock"
sleep 1

echo ""
echo "âœ… UI components stopped. Use 'makaron-ui-start' to re-enable."

